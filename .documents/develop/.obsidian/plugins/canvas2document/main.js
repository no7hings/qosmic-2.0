/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => Canvas2DocumentPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var path = __toESM(require("path"));
var Canvas2DocumentPlugin = class extends import_obsidian.Plugin {
  async onload() {
    if (this.app.vault.adapter instanceof import_obsidian.FileSystemAdapter) {
      this.fsadapter = this.app.vault.adapter;
    } else {
      return;
    }
    this.addCommand({
      id: "run-conversion",
      name: "Convert canvas to a longform document",
      callback: async () => {
        const canvStruct = await this.readCanvasStruct();
        if (canvStruct == false) {
          new import_obsidian.Notice(`this is not a canvas file`);
          return;
        }
        const contents = await this.readCanvasData(canvStruct);
        this.writeCanvDocFile(contents, canvStruct);
      }
    });
    this.addCommand({
      id: "run-redoc",
      name: "Clear canvas2document target document",
      callback: async () => {
        const canvStruct = await this.readC2Dtarget();
        if (canvStruct == false) {
          new import_obsidian.Notice(`this is not a canvas2document target file`);
          return;
        }
        this.writeC2Doc(canvStruct);
      }
    });
  }
  onunload() {
  }
  async readC2Dtarget() {
    let activeFile = this.app.workspace.getActiveFile();
    if (!activeFile || !activeFile.name.includes("_fromCanvas.md")) {
      return false;
    } else {
      let mdFolderPath = path.dirname(activeFile.path);
    }
    let content = this.app.vault.cachedRead(activeFile);
    return content;
  }
  async writeC2Doc(canvStruct) {
    let activeFile = this.app.workspace.getActiveFile();
    let mdFolderPath = path.dirname(activeFile.path);
    const pattern = /\!\[\[([^[\]]+)\]\]/g;
    const matches = canvStruct.match(pattern);
    let doccontentstring = "> [!success] This is your converted and cleared document from Canvas2Document\n> (you can delete this infobox)\n\n";
    if (!matches) {
      return;
    }
    let textfilenames = [];
    let filenames = [];
    matches.forEach((match) => {
      let embeddedfilename = match.replace(/\!\[\[(.*)\]\]/, "$1");
      if (embeddedfilename.endsWith(".md")) {
        if (embeddedfilename.startsWith("./")) {
          embeddedfilename = embeddedfilename.replace("./", "");
        }
        textfilenames.push(embeddedfilename);
      }
      filenames.push(embeddedfilename);
    });
    const fileContents = await Promise.all(
      textfilenames.map(
        async (file) => [file, await this.app.vault.cachedRead(this.app.vault.getAbstractFileByPath(file))]
      )
    );
    for (const xfile of filenames) {
      if (xfile.endsWith(".md")) {
        const found = fileContents.find((element) => element[0] == xfile);
        doccontentstring += found[1] + "\n\n";
      } else {
        doccontentstring += "![[" + xfile + "]]\n\n";
      }
    }
    let docFilename;
    if (mdFolderPath == ".") {
      docFilename = activeFile.basename + "_" + Math.round(new Date().getTime() / 1e3) + "_fromC2D.md";
    } else {
      docFilename = mdFolderPath + "/" + activeFile.basename + "_" + Math.round(new Date().getTime() / 1e3) + "_fromC2D.md";
    }
    try {
      await this.app.vault.create(docFilename, doccontentstring);
    } catch (e) {
      console.log("error writing the new cleare doc file " + e);
    }
    const docftab = await this.app.vault.getAbstractFileByPath(docFilename);
    try {
      await this.app.workspace.getLeaf("split").openFile(docftab);
    } catch (e) {
      console.log(e);
    }
    return;
  }
  async readCanvasStruct() {
    let activeFile = this.app.workspace.getActiveFile();
    if (!activeFile || activeFile.extension != "canvas") {
      return false;
    } else {
      let mdFolderPath = path.dirname(activeFile.path);
    }
    let content = this.app.vault.cachedRead(activeFile);
    return content;
  }
  async readCanvasData(struct) {
    const fileContents = [];
    let myparsed_data = JSON.parse(struct);
    for (const node of myparsed_data.nodes) {
      const id = node.id;
      const type = node.type;
      let nodefile = "";
      if (type === "file") {
        nodefile = node.file;
        const { name, ext } = path.parse(nodefile);
        if (ext === ".md") {
          fileContents.push([id, type, nodefile, "textfile"]);
        } else if (ext === ".jpg" || ext == ".jpeg" || ext === ".png" || ext === ".gif") {
          fileContents.push([id, type, nodefile, "contentimage"]);
        } else if (ext === ".pdf") {
          fileContents.push([id, type, nodefile, "contentpdf"]);
        } else {
        }
      } else if (type === "link") {
        if (node.url.includes("youtube")) {
          const url = node.url;
          fileContents.push([id, type, url, "contentyoutube"]);
        } else {
          fileContents.push([id, type, node.url, "contentlink"]);
        }
      } else if (type === "text") {
        const text = node.text;
        fileContents.push([id, type, "node", text]);
      }
    }
    return fileContents;
  }
  getNodes(id) {
    return;
  }
  async writeCanvDocFile(content, convStruct) {
    let activeFile = this.app.workspace.getActiveFile();
    let mdFolderPath = path.dirname(activeFile.path);
    let writeworkdir = mdFolderPath + "/" + activeFile.basename + "_canvas2doc-data";
    this.fsadapter.mkdir(writeworkdir);
    let canvasFile;
    let canvasFilename;
    if (mdFolderPath == ".") {
      canvasFilename = activeFile.basename + "_" + Math.round(new Date().getTime() / 1e3) + "_fromCanvas.md";
    } else {
      canvasFilename = mdFolderPath + "/" + activeFile.basename + "_" + Math.round(new Date().getTime() / 1e3) + "_fromCanvas.md";
    }
    let contentString = "> [!info] This is an automatically generated document from Plugin [Canvas2Document](https://github.com/slnsys/obsidian-canvas2document)\n> arrange the document as you need with the outline, then call *Clear canvas2document target document*\n\n";
    let myparsed_data = JSON.parse(convStruct);
    for (const element of content) {
      let cnfname = "";
      if (element[1] == "text") {
        cnfname = writeworkdir + "/newdoc-node_" + element[0] + "_fromCanvas.md";
        contentString += "\n\n# ___card from Canvas\n";
        contentString += element[2] + " ^" + element[0] + "\n\n";
        contentString += "> [!tip] link navigation from the canvas\n";
        for (const edge of myparsed_data.edges) {
          if (edge.fromNode == element[0]) {
            contentString += "> linking to: [[#^" + edge.toNode + "|canvaslink]]\n";
          }
          if (edge.toNode == element[0]) {
            contentString += "> linked from: [[#^" + edge.fromNode + "|canvaslink]]\n";
          }
        }
        contentString += "\n ![[" + cnfname + "]]\n\n";
      } else if (element[1] == "link") {
        contentString += "\n\n# ___link from Canvas\n";
        contentString += element[2] + " ^" + element[0] + "\n\n";
        contentString += "> [!tip] link navigation from the canvas\n";
        for (const edge of myparsed_data.edges) {
          if (edge.fromNode == element[0]) {
            contentString += "> linking to: [[#^" + edge.toNode + "|canvaslink]]\n";
          }
          if (edge.toNode == element[0]) {
            contentString += "> linked from: [[#^" + edge.fromNode + "|canvaslink]]\n";
          }
        }
        if (element[3] == "contentyoutube") {
          contentString += "\n ![](" + element[2] + ")\n\n";
        } else if (element[3] == "contentlink") {
          contentString += '\n <iframe src="' + element[2] + '"></iframe>\n\n';
        }
      } else if (element[1] == "file") {
        if (element[3] == "contentimage" || element[3] == "contentpdf") {
          contentString += "\n\n# ___Media from Canvas\n";
          contentString += element[2] + " ^" + element[0] + "\n\n";
          contentString += "> [!tip] link navigation from the canvas\n";
          for (const edge of myparsed_data.edges) {
            if (edge.fromNode == element[0]) {
              contentString += "> linking to: [[#^" + edge.toNode + "|canvaslink]]\n";
            }
            if (edge.toNode == element[0]) {
              contentString += "> linked from: [[#^" + edge.fromNode + "|canvaslink]]\n";
            }
          }
          if (element[3] == "contentpdf") {
            contentString += "\n ![[" + element[2] + "#height=500]]\n\n";
          } else if (element[3] == "contentimage") {
            contentString += "\n ![[" + element[2] + "|500]]\n\n";
          }
        } else {
          contentString += "\n\n# ___noteFile from Canvas\n";
          contentString += element[2] + " ^" + element[0] + "\n\n";
          contentString += "> [!tip] link navigation from the canvas\n";
          for (const edge of myparsed_data.edges) {
            if (edge.fromNode == element[0]) {
              contentString += "> linking to: [[#^" + edge.toNode + "|canvaslink]]\n";
            }
            if (edge.toNode == element[0]) {
              contentString += "> linked from: [[#^" + edge.fromNode + "|canvaslink]]\n";
            }
          }
          contentString += "\n ![[" + element[2] + "]]\n\n";
        }
      }
      let canvasnodeFile;
      try {
        let cnfabst2 = this.app.vault.getAbstractFileByPath(cnfname);
        this.app.vault.delete(cnfabst2, true);
        canvasnodeFile = this.app.vault.create(cnfname, element[3]);
      } catch (e) {
        console.log(e);
        return;
      }
    }
    try {
      canvasFile = await this.app.vault.create(canvasFilename, contentString);
    } catch (e) {
      console.log("error writing the new doc file " + e);
    }
    const cnfabst = await this.app.vault.getAbstractFileByPath(canvasFilename);
    try {
      await this.app.workspace.getLeaf("split").openFile(cnfabst);
    } catch (e) {
      console.log(e);
    }
    return;
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgbm9ybWFsaXplUGF0aCwgV29ya3NwYWNlLCBXb3Jrc3BhY2VMZWFmLCBURmlsZSwgQXBwLCBFZGl0b3IsIE1hcmtkb3duVmlldywgTm90aWNlLCBQbHVnaW4sIEZpbGVTeXN0ZW1BZGFwdGVyIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG4vLyBpbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYW52YXMyRG9jdW1lbnRQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG5cdGZzYWRhcHRlcjogRmlsZVN5c3RlbUFkYXB0ZXI7XHJcblxyXG5cdGFzeW5jIG9ubG9hZCgpIHtcclxuXHRcclxuXHRcdC8vIHRoaXMuZnNhZGFwdGVyID0gdGhpcy5hcHAudmF1bHQuYWRhcHRlciBhcyBGaWxlU3lzdGVtQWRhcHRlcjtcclxuXHRcdCBpZiAodGhpcy5hcHAudmF1bHQuYWRhcHRlciBpbnN0YW5jZW9mIEZpbGVTeXN0ZW1BZGFwdGVyKSB7XHJcblx0XHRcdHRoaXMuZnNhZGFwdGVyID0gdGhpcy5hcHAudmF1bHQuYWRhcHRlciBhcyBGaWxlU3lzdGVtQWRhcHRlcjtcclxuXHRcdCB9IGVsc2Uge1xyXG5cdFx0XHQvL1RPRE8gdGhyb3cgZXhjZXB0aW9uIGZvciBmc2FkYXB0ZXJcclxuXHRcdFx0cmV0dXJuXHJcblx0XHQgfVxyXG5cclxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XHJcblx0XHRcdGlkOiBcInJ1bi1jb252ZXJzaW9uXCIsXHJcblx0XHRcdG5hbWU6IFwiQ29udmVydCBjYW52YXMgdG8gYSBsb25nZm9ybSBkb2N1bWVudFwiLFxyXG5cdFx0XHRjYWxsYmFjazogYXN5bmMgKCkgPT4ge1xyXG5cdFx0XHRcdGNvbnN0IGNhbnZTdHJ1Y3QgPSBhd2FpdCB0aGlzLnJlYWRDYW52YXNTdHJ1Y3QoKTtcclxuXHRcdFx0XHRpZiAoY2FudlN0cnVjdCA9PSBmYWxzZSkge1xyXG5cdFx0XHRcdFx0bmV3IE5vdGljZShgdGhpcyBpcyBub3QgYSBjYW52YXMgZmlsZWApO1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Y29uc3QgY29udGVudHMgPSBhd2FpdCB0aGlzLnJlYWRDYW52YXNEYXRhKGNhbnZTdHJ1Y3QpO1xyXG5cclxuXHRcdFx0XHR0aGlzLndyaXRlQ2FudkRvY0ZpbGUoY29udGVudHMsIGNhbnZTdHJ1Y3QpO1xyXG5cclxuXHRcdFx0fSxcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XHJcblx0XHRcdGlkOiBcInJ1bi1yZWRvY1wiLFxyXG5cdFx0XHRuYW1lOiBcIkNsZWFyIGNhbnZhczJkb2N1bWVudCB0YXJnZXQgZG9jdW1lbnRcIixcclxuXHRcdFx0Y2FsbGJhY2s6IGFzeW5jICgpID0+IHtcclxuXHRcdFx0XHRjb25zdCBjYW52U3RydWN0ID0gYXdhaXQgdGhpcy5yZWFkQzJEdGFyZ2V0KCk7XHJcblx0XHRcdFx0aWYgKGNhbnZTdHJ1Y3QgPT0gZmFsc2UpIHtcclxuXHRcdFx0XHRcdG5ldyBOb3RpY2UoYHRoaXMgaXMgbm90IGEgY2FudmFzMmRvY3VtZW50IHRhcmdldCBmaWxlYCk7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBjb25zdCBjb250ZW50cyA9IGF3YWl0IHRoaXMucmVhZENhbnZhc0RhdGEoY2FudlN0cnVjdCk7XHJcblxyXG5cdFx0XHRcdHRoaXMud3JpdGVDMkRvYyhjYW52U3RydWN0KTtcclxuXHRcdFx0fSxcclxuXHRcdH0pO1xyXG5cclxuXHR9XHJcblxyXG5cdG9udW5sb2FkKCkge1xyXG5cdFx0Ly8gVE9ETyBjbGVhbmluZyB1cFxyXG5cdH1cclxuXHJcblx0YXN5bmMgcmVhZEMyRHRhcmdldCgpOiBQcm9taXNlPG51bWJlcj4ge1xyXG5cdFx0LypcclxuXHRcdGNoZWNrIG9uIGFjdGl2ZSBmaWxlIGlzIGNhbnZhc1xyXG5cdFx0Ki9cclxuXHRcdGxldCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuXHJcblx0XHQvL2ZpbGVuYW1lIG9mIHRoZSBhY3RpdmUgZmlsZSBjb250YWlucyBcIl9mcm9tQ2FudmFzLm1kXCJcclxuXHRcdGlmICghYWN0aXZlRmlsZSB8fCAhYWN0aXZlRmlsZS5uYW1lLmluY2x1ZGVzKFwiX2Zyb21DYW52YXMubWRcIikpIHtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0bGV0IG1kRm9sZGVyUGF0aDogc3RyaW5nID0gcGF0aC5kaXJuYW1lKGFjdGl2ZUZpbGUucGF0aCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gVE9ETzogcHJldmVudCByZWFkaW5nIGFsbCBmaWxlcywganVzdCB0aGUgYWN0aXZlIGZpbGUsIGlmIGNhbnZhcyBjaGVjayBva1xyXG5cclxuXHRcdC8vbGV0IGFjdGNhbnZhc2ZpbGUgPSBhcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGFjdGl2ZUZpbGUpO1xyXG5cdFx0bGV0IGNvbnRlbnQgPSB0aGlzLmFwcC52YXVsdC5jYWNoZWRSZWFkKGFjdGl2ZUZpbGUpO1xyXG5cclxuXHRcdHJldHVybiBjb250ZW50O1xyXG5cdH1cdFxyXG5cclxuXHJcblx0YXN5bmMgd3JpdGVDMkRvYyhjYW52U3RydWN0KSB7XHJcblxyXG5cdFx0bGV0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xyXG5cdFx0bGV0IG1kRm9sZGVyUGF0aDogc3RyaW5nID0gcGF0aC5kaXJuYW1lKGFjdGl2ZUZpbGUucGF0aCk7XHJcblxyXG5cdFx0Y29uc3QgcGF0dGVybiA9IC9cXCFcXFtcXFsoW15bXFxdXSspXFxdXFxdL2c7XHJcblx0XHRjb25zdCBtYXRjaGVzID0gY2FudlN0cnVjdC5tYXRjaChwYXR0ZXJuKTtcclxuXHJcblx0XHRsZXQgZG9jY29udGVudHN0cmluZyA9IFwiPiBbIXN1Y2Nlc3NdIFRoaXMgaXMgeW91ciBjb252ZXJ0ZWQgYW5kIGNsZWFyZWQgZG9jdW1lbnQgZnJvbSBDYW52YXMyRG9jdW1lbnRcXG5cXD4gKHlvdSBjYW4gZGVsZXRlIHRoaXMgaW5mb2JveClcXG5cXG5cIlxyXG5cclxuXHRcdGlmICghIG1hdGNoZXMpIHtcclxuXHRcdFx0cmV0dXJuXHJcblx0XHR9XHJcblxyXG5cdFx0bGV0IHRleHRmaWxlbmFtZXMgPSBbXVxyXG5cdFx0bGV0IGZpbGVuYW1lcyA9IFtdXHJcblxyXG5cdFx0bWF0Y2hlcy5mb3JFYWNoKG1hdGNoID0+IHtcclxuXHRcdFx0bGV0IGVtYmVkZGVkZmlsZW5hbWUgPSBtYXRjaC5yZXBsYWNlKC9cXCFcXFtcXFsoLiopXFxdXFxdLywgJyQxJyk7XHJcblxyXG5cdFx0XHRpZiAoZW1iZWRkZWRmaWxlbmFtZS5lbmRzV2l0aChcIi5tZFwiKSkge1xyXG5cdFx0XHRcdC8vIGlmIGVtYmVkZGVkZmlsZW5hbWUgc3RhcnRzIHdpdGggXCIuL1wiIHJlbW92ZSBpdFxyXG5cdFx0XHRcdGlmIChlbWJlZGRlZGZpbGVuYW1lLnN0YXJ0c1dpdGgoXCIuL1wiKSkge1xyXG5cdFx0XHRcdFx0ZW1iZWRkZWRmaWxlbmFtZSA9IGVtYmVkZGVkZmlsZW5hbWUucmVwbGFjZShcIi4vXCIsIFwiXCIpXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRleHRmaWxlbmFtZXMucHVzaChlbWJlZGRlZGZpbGVuYW1lKTtcclxuXHRcdFx0fSBcclxuXHJcblx0XHRcdGZpbGVuYW1lcy5wdXNoKGVtYmVkZGVkZmlsZW5hbWUpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0Y29uc3QgZmlsZUNvbnRlbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXHJcblx0XHRcdHRleHRmaWxlbmFtZXMubWFwKFxyXG5cdFx0XHQgIGFzeW5jIChmaWxlKSA9PiBbZmlsZSwgYXdhaXQgdGhpcy5hcHAudmF1bHQuY2FjaGVkUmVhZCh0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZSkpXSBhcyBjb25zdCxcclxuXHRcdFx0KSxcclxuXHQgICAgKTtcclxuXHJcblx0XHRmb3IgKGNvbnN0IHhmaWxlIG9mIGZpbGVuYW1lcykge1xyXG5cdFx0XHRpZiAoeGZpbGUuZW5kc1dpdGgoXCIubWRcIikpIHtcclxuXHRcdFx0XHRjb25zdCBmb3VuZCA9IGZpbGVDb250ZW50cy5maW5kKChlbGVtZW50KSA9PiBlbGVtZW50WzBdID09IHhmaWxlKTtcclxuXHRcdFx0XHRkb2Njb250ZW50c3RyaW5nICs9IGZvdW5kWzFdICsgXCJcXG5cXG5cIlxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGRvY2NvbnRlbnRzdHJpbmcgKz0gXCIhW1tcIiArIHhmaWxlICsgXCJdXVxcblxcblwiXHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRsZXQgZG9jRmlsZW5hbWVcclxuXHRcdGlmIChtZEZvbGRlclBhdGggPT0gXCIuXCIpIHtcclxuXHQgICAgXHRkb2NGaWxlbmFtZSA9IGFjdGl2ZUZpbGUuYmFzZW5hbWUgKyBcIl9cIiArIE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkvMTAwMCkgKyBcIl9mcm9tQzJELm1kXCJcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGRvY0ZpbGVuYW1lID0gbWRGb2xkZXJQYXRoICsgXCIvXCIgKyBhY3RpdmVGaWxlLmJhc2VuYW1lICsgXCJfXCIgKyBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpLzEwMDApICsgXCJfZnJvbUMyRC5tZFwiXHRcdFx0XHRcdFxyXG5cdFx0fVxyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdGF3YWl0IHRoaXMuYXBwLnZhdWx0LmNyZWF0ZShkb2NGaWxlbmFtZSwgZG9jY29udGVudHN0cmluZylcclxuXHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0Y29uc29sZS5sb2coXCJlcnJvciB3cml0aW5nIHRoZSBuZXcgY2xlYXJlIGRvYyBmaWxlIFwiICsgZSlcclxuXHRcdH1cclxuXHJcblx0XHRjb25zdCBkb2NmdGFiID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGRvY0ZpbGVuYW1lKTtcclxuXHJcblx0XHR0cnkge1xyXG5cdFx0XHRhd2FpdCB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZignc3BsaXQnKS5vcGVuRmlsZShkb2NmdGFiKTtcclxuXHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0Y29uc29sZS5sb2coZSlcclxuXHRcdH1cclxuXHRcdHJldHVyblxyXG5cdH1cclxuXHJcblx0YXN5bmMgcmVhZENhbnZhc1N0cnVjdCgpOiBQcm9taXNlPG51bWJlcj4ge1xyXG5cdFx0LypcclxuXHRcdGNoZWNrIG9uIGFjdGl2ZSBmaWxlIGlzIGNhbnZhc1xyXG5cdFx0Ki9cclxuXHRcdGxldCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuXHRcdGlmICghYWN0aXZlRmlsZSB8fCBhY3RpdmVGaWxlLmV4dGVuc2lvbiAhPSBcImNhbnZhc1wiKSB7XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGxldCBtZEZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguZGlybmFtZShhY3RpdmVGaWxlLnBhdGgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIFRPRE86IHByZXZlbnQgcmVhZGluZyBhbGwgZmlsZXMsIGp1c3QgdGhlIGFjdGl2ZSBmaWxlLCBpZiBjYW52YXMgY2hlY2sgb2tcclxuXHJcblx0XHQvL2xldCBhY3RjYW52YXNmaWxlID0gYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChhY3RpdmVGaWxlKTtcclxuXHRcdGxldCBjb250ZW50ID0gdGhpcy5hcHAudmF1bHQuY2FjaGVkUmVhZChhY3RpdmVGaWxlKTtcclxuXHJcblx0XHRyZXR1cm4gY29udGVudDtcclxuXHR9XHRcclxuXHJcblxyXG5cdGFzeW5jIHJlYWRDYW52YXNEYXRhKHN0cnVjdCk6IFByb21pc2U8bnVtYmVyPiB7XHJcblx0XHQvLyBUT0RPOiBub2NobWFsIG5hY2ggaHR0cHM6Ly9kb2NzLm9ic2lkaWFuLm1kL1BsdWdpbnMvVmF1bHQsIHJlYWQgYWxsIGZpbGVzXHJcblx0XHQvLyBpbnB1dCBsaXN0ZSBlYmVuIGF1cyBjYW52YXMtSlNPTiBhbGxlIG5vZGVzXHJcblxyXG5cdFx0Y29uc3QgZmlsZUNvbnRlbnRzOiBbc3RyaW5nLCBzdHJpbmcsIHN0cmluZywgc3RyaW5nXVtdID0gW107XHJcblxyXG5cdFx0bGV0ICBteXBhcnNlZF9kYXRhID0gSlNPTi5wYXJzZShzdHJ1Y3QpO1xyXG5cclxuXHRcdGZvciAoY29uc3Qgbm9kZSBvZiBteXBhcnNlZF9kYXRhLm5vZGVzKSB7XHJcblx0XHRcdGNvbnN0IGlkID0gbm9kZS5pZDtcclxuXHRcdFx0Y29uc3QgdHlwZSA9IG5vZGUudHlwZTtcclxuXHRcdFx0bGV0IG5vZGVmaWxlID0gXCJcIjtcclxuXHJcblx0XHRcdGlmICh0eXBlID09PSBcImZpbGVcIikge1xyXG5cdFx0XHRcdG5vZGVmaWxlID0gbm9kZS5maWxlO1xyXG5cdFx0XHRcdGNvbnN0IHsgbmFtZSwgZXh0IH0gPSBwYXRoLnBhcnNlKG5vZGVmaWxlKTtcclxuXHJcblx0XHRcdFx0Ly8gbWFpbiBmaWxlIHR5cGUgbWFya2Rvd24gbm90ZVxyXG5cdFx0XHRcdGlmIChleHQgPT09IFwiLm1kXCIpIHtcclxuXHRcdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKFtpZCwgdHlwZSwgbm9kZWZpbGUsIFwidGV4dGZpbGVcIl0pO1xyXG5cclxuXHRcdFx0XHR9IGVsc2UgaWYgKGV4dCA9PT0gXCIuanBnXCIgfHwgZXh0ID09IFwiLmpwZWdcIiB8fCBleHQgPT09IFwiLnBuZ1wiIHx8IGV4dCA9PT0gXCIuZ2lmXCIpIHtcclxuXHRcdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKFtpZCwgdHlwZSwgbm9kZWZpbGUsIFwiY29udGVudGltYWdlXCJdKTtcclxuXHRcdFx0XHR9IGVsc2UgaWYgKGV4dCA9PT0gXCIucGRmXCIpIHtcclxuXHRcdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKFtpZCwgdHlwZSwgbm9kZWZpbGUsIFwiY29udGVudHBkZlwiXSk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdC8vVE9ETyBoYW5kbGUgdW5rbm93biBmaWxlIHR5cGVcIik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2UgaWYgKHR5cGUgPT09IFwibGlua1wiKSB7XHJcblx0XHRcdFx0aWYgKG5vZGUudXJsLmluY2x1ZGVzKFwieW91dHViZVwiKSkge1xyXG5cdFx0XHRcdFx0Y29uc3QgdXJsID0gbm9kZS51cmw7XHJcblx0XHRcdFx0XHRmaWxlQ29udGVudHMucHVzaChbaWQsIHR5cGUsIHVybCwgXCJjb250ZW50eW91dHViZVwiXSk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKFtpZCwgdHlwZSwgbm9kZS51cmwsIFwiY29udGVudGxpbmtcIl0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIGlmICh0eXBlID09PSBcInRleHRcIikge1xyXG5cdFx0XHRcdGNvbnN0IHRleHQgPSBub2RlLnRleHQ7XHJcblxyXG5cdFx0XHRcdGZpbGVDb250ZW50cy5wdXNoKFtpZCwgdHlwZSwgXCJub2RlXCIsIHRleHRdKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBmaWxlQ29udGVudHM7XHJcblx0fVxyXG5cclxuXHRnZXROb2RlcyhpZCkge1xyXG5cdFx0Ly8gZ2V0IGFsbCBub2RlcyBmcm9tIHRoZSBjYW52YXMgZmlsZVxyXG5cdFx0Ly8gcmV0dXJuIGFycmF5IG9mIG5vZGVzXHJcblx0XHRyZXR1cm47XHJcblx0XHRcclxuXHR9XHJcblx0XHJcblx0YXN5bmMgd3JpdGVDYW52RG9jRmlsZShjb250ZW50LCBjb252U3RydWN0KSB7XHJcblx0XHQvLyBlc3RhYmxpc2hpbmcgdGhlIHdvcmtkaXJcclxuXHRcdGxldCBhY3RpdmVGaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcclxuXHRcdGxldCBtZEZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguZGlybmFtZShhY3RpdmVGaWxlLnBhdGgpO1xyXG5cclxuXHRcdGxldCB3cml0ZXdvcmtkaXIgPSBtZEZvbGRlclBhdGggKyBcIi9cIiArIGFjdGl2ZUZpbGUuYmFzZW5hbWUgKyBcIl9jYW52YXMyZG9jLWRhdGFcIlxyXG5cdFx0dGhpcy5mc2FkYXB0ZXIubWtkaXIod3JpdGV3b3JrZGlyKVxyXG5cclxuXHRcdGxldCBjYW52YXNGaWxlXHJcblx0XHRsZXQgY2FudmFzRmlsZW5hbWVcclxuXHRcdGlmIChtZEZvbGRlclBhdGggPT0gXCIuXCIpIHtcclxuXHQgICAgXHRjYW52YXNGaWxlbmFtZSA9IGFjdGl2ZUZpbGUuYmFzZW5hbWUgKyBcIl9cIiArIE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkvMTAwMCkgKyBcIl9mcm9tQ2FudmFzLm1kXCJcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGNhbnZhc0ZpbGVuYW1lID0gbWRGb2xkZXJQYXRoICsgXCIvXCIgKyBhY3RpdmVGaWxlLmJhc2VuYW1lICsgXCJfXCIgKyBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpLzEwMDApICsgXCJfZnJvbUNhbnZhcy5tZFwiXHRcdFx0XHRcdFxyXG5cdFx0fVxyXG5cclxuXHRcdGxldCBjb250ZW50U3RyaW5nID0gXCI+IFshaW5mb10gVGhpcyBpcyBhbiBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBkb2N1bWVudCBmcm9tIFBsdWdpbiBbQ2FudmFzMkRvY3VtZW50XShodHRwczovL2dpdGh1Yi5jb20vc2xuc3lzL29ic2lkaWFuLWNhbnZhczJkb2N1bWVudClcXG5cXD4gYXJyYW5nZSB0aGUgZG9jdW1lbnQgYXMgeW91IG5lZWQgd2l0aCB0aGUgb3V0bGluZSwgdGhlbiBjYWxsICpDbGVhciBjYW52YXMyZG9jdW1lbnQgdGFyZ2V0IGRvY3VtZW50KlxcblxcblwiXHJcblxyXG5cdFx0bGV0IG15cGFyc2VkX2RhdGEgPSBKU09OLnBhcnNlKGNvbnZTdHJ1Y3QpO1xyXG5cclxuXHRcdGZvciAoY29uc3QgZWxlbWVudCBvZiBjb250ZW50KSB7XHJcblx0XHRcdFxyXG5cdFx0XHRsZXQgY25mbmFtZSA9IFwiXCJcclxuXHRcdFx0aWYgKGVsZW1lbnRbMV0gPT0gXCJ0ZXh0XCIpIHtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRjbmZuYW1lID0gd3JpdGV3b3JrZGlyICsgXCIvXCIgKyBcIm5ld2RvYy1ub2RlX1wiICsgZWxlbWVudFswXSArIFwiX2Zyb21DYW52YXMubWRcIlxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdC8vIGhlYWRpbmcgZlx1MDBGQ3IgbmF2aSBsaW5rc1xyXG5cdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCJcXG5cXG4jIF9fX2NhcmQgZnJvbSBDYW52YXNcXG5cIlxyXG5cclxuXHRcdFx0XHQvLyBGaWxlbmFtZSB1bmQgaW50ZXJuZXIgbGluayBhbmNob3JcclxuXHRcdFx0XHRjb250ZW50U3RyaW5nICs9IGVsZW1lbnRbMl0gKyBcIiBeXCIgKyBlbGVtZW50WzBdICsgXCJcXG5cXG5cIlxyXG5cclxuXHRcdFx0XHQvLyBsaW5raW5nIGJveFxyXG5cdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCI+IFshdGlwXSBsaW5rIG5hdmlnYXRpb24gZnJvbSB0aGUgY2FudmFzXFxuXCJcclxuXHRcdFx0XHRmb3IgKGNvbnN0IGVkZ2Ugb2YgbXlwYXJzZWRfZGF0YS5lZGdlcykge1xyXG5cdFx0XHRcdFx0aWYgKGVkZ2UuZnJvbU5vZGUgPT0gZWxlbWVudFswXSkge1xyXG5cdFx0XHRcdFx0XHRjb250ZW50U3RyaW5nICs9IFwiPiBsaW5raW5nIHRvOiBbWyNeXCIgKyBlZGdlLnRvTm9kZSArIFwifGNhbnZhc2xpbmtdXVxcblwiXHJcblx0XHRcdFx0XHR9IFxyXG5cdFx0XHRcdFx0aWYgKGVkZ2UudG9Ob2RlID09IGVsZW1lbnRbMF0pIHtcclxuXHRcdFx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIj4gbGlua2VkIGZyb206IFtbI15cIiArIGVkZ2UuZnJvbU5vZGUgKyBcInxjYW52YXNsaW5rXV1cXG5cIlxyXG5cdFx0XHRcdFx0fSBcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vRW1iZWRkaW5nXHJcblx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIlxcbiAhW1tcIiArIGNuZm5hbWUgKyBcIl1dXFxuXFxuXCJcclxuXHJcblx0XHRcdH0gZWxzZSBpZiAoZWxlbWVudFsxXSA9PSBcImxpbmtcIikge1xyXG5cdFx0XHRcdC8vIGNuZm5hbWUgPSB3cml0ZXdvcmtkaXIgKyBcIi9cIiArIFwibmV3ZG9jLW5vZGVfXCIgKyBlbGVtZW50WzBdICsgXCIgX2Zyb21DYW52YXMubWRcIlxyXG5cclxuXHRcdFx0XHQvLyBoZWFkaW5nIGZcdTAwRkNyIG5hdmkgbGlua3NcclxuXHRcdFx0XHRjb250ZW50U3RyaW5nICs9IFwiXFxuXFxuIyBfX19saW5rIGZyb20gQ2FudmFzXFxuXCJcclxuXHJcblx0XHRcdFx0Ly8gRmlsZW5hbWUgdW5kIGludGVybmVyIGxpbmsgYW5jaG9yXHJcblx0XHRcdFx0Y29udGVudFN0cmluZyArPSBlbGVtZW50WzJdICsgXCIgXlwiICsgZWxlbWVudFswXSArIFwiXFxuXFxuXCJcclxuXHJcblx0XHRcdFx0Ly8gbGlua2luZyBib3hcclxuXHRcdFx0XHRjb250ZW50U3RyaW5nICs9IFwiPiBbIXRpcF0gbGluayBuYXZpZ2F0aW9uIGZyb20gdGhlIGNhbnZhc1xcblwiXHJcblx0XHRcdFx0Zm9yIChjb25zdCBlZGdlIG9mIG15cGFyc2VkX2RhdGEuZWRnZXMpIHtcclxuXHRcdFx0XHRcdGlmIChlZGdlLmZyb21Ob2RlID09IGVsZW1lbnRbMF0pIHtcclxuXHRcdFx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIj4gbGlua2luZyB0bzogW1sjXlwiICsgZWRnZS50b05vZGUgKyBcInxjYW52YXNsaW5rXV1cXG5cIlxyXG5cdFx0XHRcdFx0fSBcclxuXHRcdFx0XHRcdGlmIChlZGdlLnRvTm9kZSA9PSBlbGVtZW50WzBdKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCI+IGxpbmtlZCBmcm9tOiBbWyNeXCIgKyBlZGdlLmZyb21Ob2RlICsgXCJ8Y2FudmFzbGlua11dXFxuXCJcclxuXHRcdFx0XHRcdH0gXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvL0VtYmVkZGluZyBtZWRpYSBzcGVjaWZpY1xyXG5cdFx0XHRcdGlmIChlbGVtZW50WzNdID09IFwiY29udGVudHlvdXR1YmVcIikge1xyXG5cdFx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIlxcbiAhW10oXCIgKyBlbGVtZW50WzJdICsgXCIpXFxuXFxuXCJcclxuXHRcdFx0XHR9IGVsc2UgaWYgKGVsZW1lbnRbM10gPT0gXCJjb250ZW50bGlua1wiKSB7XHJcblx0XHRcdFx0XHRjb250ZW50U3RyaW5nICs9IFwiXFxuIDxpZnJhbWUgc3JjPVxcXCJcIiArIGVsZW1lbnRbMl0gKyBcIlxcXCI+PC9pZnJhbWU+XFxuXFxuXCJcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHR9IGVsc2UgaWYgKGVsZW1lbnRbMV0gPT0gXCJmaWxlXCIpIHtcclxuXHRcdFx0XHRpZiAoZWxlbWVudFszXSA9PSBcImNvbnRlbnRpbWFnZVwiIHx8IGVsZW1lbnRbM10gPT0gXCJjb250ZW50cGRmXCIpIHtcclxuXHJcblx0XHRcdFx0XHQvLyBoZWFkaW5nIGZcdTAwRkNyIG5hdmkgbGlua3NcclxuXHRcdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCJcXG5cXG4jIF9fX01lZGlhIGZyb20gQ2FudmFzXFxuXCJcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRcdC8vIHN0YXJ0dGFnIG1ldGEgZGF0YSBibG9ja1xyXG5cdFx0XHRcdFx0Ly8gY29udGVudFN0cmluZyArPSBcIlxcbiUlXFxuY2FudmFzMmRvY3VtZW50IHBsdWdpbiBtZXRhZGF0YSBoZWFkZXIgc3RhcnRcXG4lJVxcblwiXHJcblxyXG5cdFx0XHRcdFx0Ly8gRmlsZW5hbWUgdW5kIGludGVybmVyIGxpbmsgYW5jaG9yXHJcblx0XHRcdFx0XHRjb250ZW50U3RyaW5nICs9IGVsZW1lbnRbMl0gKyBcIiBeXCIgKyBlbGVtZW50WzBdICsgXCJcXG5cXG5cIlxyXG5cclxuXHRcdFx0XHRcdC8vIGxpbmtpbmcgYm94XHJcblx0XHRcdFx0XHQvLyBUT0RPIGxpbmtpbmcgYm94IG5vY2ggaW4gZnVua3Rpb24gYXVzbGFnZXJuXHJcblx0XHRcdFx0XHRjb250ZW50U3RyaW5nICs9IFwiPiBbIXRpcF0gbGluayBuYXZpZ2F0aW9uIGZyb20gdGhlIGNhbnZhc1xcblwiXHJcblx0XHRcdFx0XHRmb3IgKGNvbnN0IGVkZ2Ugb2YgbXlwYXJzZWRfZGF0YS5lZGdlcykge1xyXG5cdFx0XHRcdFx0XHRpZiAoZWRnZS5mcm9tTm9kZSA9PSBlbGVtZW50WzBdKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIj4gbGlua2luZyB0bzogW1sjXlwiICsgZWRnZS50b05vZGUgKyBcInxjYW52YXNsaW5rXV1cXG5cIlxyXG5cdFx0XHRcdFx0XHR9IFxyXG5cdFx0XHRcdFx0XHRpZiAoZWRnZS50b05vZGUgPT0gZWxlbWVudFswXSkge1xyXG5cdFx0XHRcdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCI+IGxpbmtlZCBmcm9tOiBbWyNeXCIgKyBlZGdlLmZyb21Ob2RlICsgXCJ8Y2FudmFzbGlua11dXFxuXCJcclxuXHRcdFx0XHRcdFx0fSBcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdC8vIHN0YXJ0dGFnIG1ldGEgZGF0YSBibG9ja1xyXG5cdFx0XHRcdFx0Ly8gY29udGVudFN0cmluZyArPSBcIlxcbiUlXFxuY2FudmFzMmRvY3VtZW50IHBsdWdpbiBtZXRhZGF0YSBoZWFkZXIgZW5kXFxuJSVcXG5cIlxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdFx0Ly9FbWJlZGRpbmcgbWVkaWEgc3BlY2lmaWNcclxuXHRcdFx0XHRcdGlmIChlbGVtZW50WzNdID09IFwiY29udGVudHBkZlwiKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCJcXG4gIVtbXCIgKyBlbGVtZW50WzJdICsgXCIjaGVpZ2h0PTUwMF1dXFxuXFxuXCJcclxuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZWxlbWVudFszXSA9PSBcImNvbnRlbnRpbWFnZVwiKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCJcXG4gIVtbXCIgKyBlbGVtZW50WzJdICsgXCJ8NTAwXV1cXG5cXG5cIlxyXG5cdFx0XHRcdFx0fVx0XHRcdFx0XHJcblxyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdC8vIGhlYWRpbmcgZlx1MDBGQ3IgbmF2aSBsaW5rc1xyXG5cdFx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIlxcblxcbiMgX19fbm90ZUZpbGUgZnJvbSBDYW52YXNcXG5cIlxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdFx0Ly8gRmlsZW5hbWUgdW5kIGludGVybmVyIGxpbmsgYW5jaG9yXHJcblx0XHRcdFx0XHRjb250ZW50U3RyaW5nICs9IGVsZW1lbnRbMl0gKyBcIiBeXCIgKyBlbGVtZW50WzBdICsgXCJcXG5cXG5cIlxyXG5cclxuXHRcdFx0XHRcdC8vIGxpbmtpbmcgYm94XHJcblx0XHRcdFx0XHRjb250ZW50U3RyaW5nICs9IFwiPiBbIXRpcF0gbGluayBuYXZpZ2F0aW9uIGZyb20gdGhlIGNhbnZhc1xcblwiXHJcblx0XHRcdFx0XHRmb3IgKGNvbnN0IGVkZ2Ugb2YgbXlwYXJzZWRfZGF0YS5lZGdlcykge1xyXG5cdFx0XHRcdFx0XHRpZiAoZWRnZS5mcm9tTm9kZSA9PSBlbGVtZW50WzBdKSB7XHJcblx0XHRcdFx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIj4gbGlua2luZyB0bzogW1sjXlwiICsgZWRnZS50b05vZGUgKyBcInxjYW52YXNsaW5rXV1cXG5cIlxyXG5cdFx0XHRcdFx0XHR9IFxyXG5cdFx0XHRcdFx0XHRpZiAoZWRnZS50b05vZGUgPT0gZWxlbWVudFswXSkge1xyXG5cdFx0XHRcdFx0XHRcdGNvbnRlbnRTdHJpbmcgKz0gXCI+IGxpbmtlZCBmcm9tOiBbWyNeXCIgKyBlZGdlLmZyb21Ob2RlICsgXCJ8Y2FudmFzbGlua11dXFxuXCJcclxuXHRcdFx0XHRcdFx0fSBcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcclxuXHRcdFx0XHRcdC8vIEVtYmVkZGluZ1xyXG5cdFx0XHRcdFx0Y29udGVudFN0cmluZyArPSBcIlxcbiAhW1tcIiArICBlbGVtZW50WzJdICsgXCJdXVxcblxcblwiXHJcblxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bGV0IGNhbnZhc25vZGVGaWxlXHJcblxyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdGxldCBjbmZhYnN0ID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGNuZm5hbWUpO1xyXG5cdFx0XHRcdHRoaXMuYXBwLnZhdWx0LmRlbGV0ZShjbmZhYnN0LCB0cnVlKVxyXG5cdFx0XHRcdGNhbnZhc25vZGVGaWxlID0gdGhpcy5hcHAudmF1bHQuY3JlYXRlKGNuZm5hbWUsIGVsZW1lbnRbM10pXHJcblx0XHRcdH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhlKVxyXG5cdFx0XHRcdHJldHVyblxyXG5cdFx0XHR9XHRcclxuXHJcblx0XHR9XHJcblxyXG4gICBcdCAgICB0cnkge1xyXG5cdCAgICAgIGNhbnZhc0ZpbGUgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoY2FudmFzRmlsZW5hbWUsIGNvbnRlbnRTdHJpbmcpXHJcblx0ICAgIH0gY2F0Y2ggKGUpIHtcclxuXHRcdFx0Y29uc29sZS5sb2coXCJlcnJvciB3cml0aW5nIHRoZSBuZXcgZG9jIGZpbGUgXCIgKyBlKVxyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnN0IGNuZmFic3QgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoY2FudmFzRmlsZW5hbWUpO1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdGF3YWl0IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKCdzcGxpdCcpLm9wZW5GaWxlKGNuZmFic3QpO1xyXG5cdFx0fSBjYXRjaCAoZSkge1xyXG5cdFx0XHRjb25zb2xlLmxvZyhlKVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuXHJcblxyXG5cdH1cclxufVxyXG5cclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxzQkFBNkg7QUFFN0gsV0FBc0I7QUFFdEIsSUFBcUIsd0JBQXJCLGNBQW1ELHVCQUFPO0FBQUEsRUFHekQsTUFBTSxTQUFTO0FBR2IsUUFBSSxLQUFLLElBQUksTUFBTSxtQkFBbUIsbUNBQW1CO0FBQ3pELFdBQUssWUFBWSxLQUFLLElBQUksTUFBTTtBQUFBLElBQ2hDLE9BQU87QUFFUDtBQUFBLElBQ0E7QUFFRCxTQUFLLFdBQVc7QUFBQSxNQUNmLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsWUFBWTtBQUNyQixjQUFNLGFBQWEsTUFBTSxLQUFLLGlCQUFpQjtBQUMvQyxZQUFJLGNBQWMsT0FBTztBQUN4QixjQUFJLHVCQUFPLDJCQUEyQjtBQUN0QztBQUFBLFFBQ0Q7QUFFQSxjQUFNLFdBQVcsTUFBTSxLQUFLLGVBQWUsVUFBVTtBQUVyRCxhQUFLLGlCQUFpQixVQUFVLFVBQVU7QUFBQSxNQUUzQztBQUFBLElBQ0QsQ0FBQztBQUVELFNBQUssV0FBVztBQUFBLE1BQ2YsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxZQUFZO0FBQ3JCLGNBQU0sYUFBYSxNQUFNLEtBQUssY0FBYztBQUM1QyxZQUFJLGNBQWMsT0FBTztBQUN4QixjQUFJLHVCQUFPLDJD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
